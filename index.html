<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stock Analysis - Multi-Agent Intelligence</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: #0f0f1e;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }
        
        .agent-toggle {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .agent-toggle:hover {
            transform: translateY(-2px);
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            border-color: rgba(102, 126, 234, 0.6);
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.2);
        }
        
        .chat-input {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 16px 24px;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .history-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.4);
            transform: translateX(4px);
        }
        
        .favorite-star {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .favorite-star:hover {
            transform: scale(1.2) rotate(72deg);
        }
        
        .loading-dots {
            display: inline-flex;
            gap: 4px;
        }
        
        .loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        
        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        .price-target-bar {
            height: 8px;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
            border-radius: 4px;
            position: relative;
        }
        
        .price-indicator {
            position: absolute;
            top: -20px;
            transform: translateX(-50%);
            background: white;
            color: #0f0f1e;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .settings-panel {
            position: fixed;
            right: -400px;
            top: 0;
            height: 100vh;
            width: 400px;
            background: rgba(15, 15, 30, 0.98);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .growth-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .growth-positive {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .growth-negative {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .insight-card {
            animation: slideInUp 0.4s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .mobile-hide {
            display: block;
        }
        
        @media (max-width: 768px) {
            .mobile-hide {
                display: none;
            }
            
            .settings-panel {
                width: 100%;
                right: -100%;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Main App Component
        function StockAnalysisApp() {
            const [ticker, setTicker] = useState('');
            const [analyzing, setAnalyzing] = useState(false);
            const [analysis, setAnalysis] = useState(null);
            const [history, setHistory] = useState([]);
            const [favorites, setFavorites] = useState(new Set());
            const [settingsOpen, setSettingsOpen] = useState(false);
            const [enabledAgents, setEnabledAgents] = useState({
                'analyst_consensus': true,
                'news_sentiment': true,
                'management_quality': true,
                'peer_comparison': true,
                'market_intelligence': true,
                'financial_analyst': true,
                'tech_risk': true,
                'valuation': true
            });

            // Load from localStorage
            useEffect(() => {
                const savedHistory = localStorage.getItem('stockHistory');
                const savedFavorites = localStorage.getItem('stockFavorites');
                const savedAgents = localStorage.getItem('enabledAgents');
                
                if (savedHistory) setHistory(JSON.parse(savedHistory));
                if (savedFavorites) setFavorites(new Set(JSON.parse(savedFavorites)));
                if (savedAgents) setEnabledAgents(JSON.parse(savedAgents));
            }, []);

            const analyzeStock = async (tickerToAnalyze = ticker) => {
                if (!tickerToAnalyze.trim()) return;
                
                setAnalyzing(true);
                setAnalysis(null);
                
                // Add to history
                const newHistory = [
                    { ticker: tickerToAnalyze.toUpperCase(), timestamp: Date.now() },
                    ...history.filter(h => h.ticker !== tickerToAnalyze.toUpperCase())
                ].slice(0, 10);
                
                setHistory(newHistory);
                localStorage.setItem('stockHistory', JSON.stringify(newHistory));
                
                // Simulate analysis
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const mockAnalysis = generateEnhancedAnalysis(tickerToAnalyze.toUpperCase(), enabledAgents);
                setAnalysis(mockAnalysis);
                setAnalyzing(false);
            };

            const toggleFavorite = (ticker) => {
                const newFavorites = new Set(favorites);
                if (newFavorites.has(ticker)) {
                    newFavorites.delete(ticker);
                } else {
                    newFavorites.add(ticker);
                }
                setFavorites(newFavorites);
                localStorage.setItem('stockFavorites', JSON.stringify([...newFavorites]));
            };

            const toggleAgent = (agentKey) => {
                const newAgents = { ...enabledAgents, [agentKey]: !enabledAgents[agentKey] };
                setEnabledAgents(newAgents);
                localStorage.setItem('enabledAgents', JSON.stringify(newAgents));
            };

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="glass-card m-4 p-6 flex items-center justify-between sticky top-4 z-50">
                        <div className="flex items-center gap-4">
                            <div className="w-12 h-12 rounded-full gradient-bg flex items-center justify-center">
                                <i className="fas fa-brain text-white text-xl"></i>
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold">AI Stock Analysis</h1>
                                <p className="text-sm text-gray-400">Multi-Agent Intelligence Platform</p>
                            </div>
                        </div>
                        <button 
                            onClick={() => setSettingsOpen(!settingsOpen)}
                            className="w-10 h-10 rounded-lg glass-card flex items-center justify-center hover:bg-white/10 transition"
                        >
                            <i className="fas fa-cog text-xl"></i>
                        </button>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 pb-12">
                        <div className="grid lg:grid-cols-12 gap-6">
                            {/* Left Sidebar - History & Favorites */}
                            <div className="lg:col-span-3 mobile-hide">
                                <HistorySidebar 
                                    history={history}
                                    favorites={favorites}
                                    onSelect={analyzeStock}
                                    onToggleFavorite={toggleFavorite}
                                />
                            </div>

                            {/* Main Content */}
                            <div className="lg:col-span-9 space-y-6">
                                {/* Chat Input */}
                                <ChatInput 
                                    ticker={ticker}
                                    setTicker={setTicker}
                                    onAnalyze={analyzeStock}
                                    analyzing={analyzing}
                                />

                                {/* Analysis Results */}
                                {analyzing && <AnalyzingState />}
                                
                                {analysis && !analyzing && (
                                    <>
                                        {/* Key Metrics Dashboard */}
                                        <KeyMetricsDashboard metrics={analysis.metrics} />
                                        
                                        {/* Price Target Section */}
                                        <PriceTargetSection targets={analysis.priceTargets} />
                                        
                                        {/* Financial Metrics with Historical Growth */}
                                        <FinancialMetricsSection financials={analysis.financials} />
                                        
                                        {/* Growth Indicators */}
                                        <GrowthIndicators growth={analysis.growthMetrics} />
                                        
                                        {/* Agent Insights */}
                                        <AgentInsights 
                                            insights={analysis.agentInsights}
                                            enabledAgents={enabledAgents}
                                        />
                                        
                                        {/* Charts */}
                                        <ChartsSection analysis={analysis} />
                                    </>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Settings Panel */}
                    <SettingsPanel 
                        isOpen={settingsOpen}
                        onClose={() => setSettingsOpen(false)}
                        enabledAgents={enabledAgents}
                        onToggleAgent={toggleAgent}
                    />
                </div>
            );
        }

        // Chat Input Component
        function ChatInput({ ticker, setTicker, onAnalyze, analyzing }) {
            return (
                <div className="glass-card p-8">
                    <div className="flex gap-4">
                        <div className="flex-1 relative">
                            <input
                                type="text"
                                placeholder="Enter stock ticker (e.g., AAPL, NVDA, TSLA)..."
                                value={ticker}
                                onChange={(e) => setTicker(e.target.value.toUpperCase())}
                                onKeyPress={(e) => e.key === 'Enter' && onAnalyze()}
                                className="chat-input w-full"
                                disabled={analyzing}
                            />
                            <i className="fas fa-search absolute right-6 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button
                            onClick={() => onAnalyze()}
                            disabled={analyzing || !ticker.trim()}
                            className="px-8 py-4 gradient-bg rounded-full font-semibold hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2"
                        >
                            {analyzing ? (
                                <>
                                    <span>Analyzing</span>
                                    <div className="loading-dots">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </>
                            ) : (
                                <>
                                    <i className="fas fa-bolt"></i>
                                    <span>Analyze</span>
                                </>
                            )}
                        </button>
                    </div>
                </div>
            );
        }

        // History Sidebar Component
        function HistorySidebar({ history, favorites, onSelect, onToggleFavorite }) {
            const favoritesList = history.filter(h => favorites.has(h.ticker));
            const recentList = history.filter(h => !favorites.has(h.ticker)).slice(0, 5);

            return (
                <div className="space-y-6 sticky top-32">
                    {favoritesList.length > 0 && (
                        <div className="glass-card p-4">
                            <h3 className="text-sm font-semibold text-gray-400 mb-3 flex items-center gap-2">
                                <i className="fas fa-star text-yellow-400"></i>
                                FAVORITES
                            </h3>
                            {favoritesList.map(item => (
                                <HistoryItem 
                                    key={item.ticker}
                                    item={item}
                                    isFavorite={true}
                                    onSelect={onSelect}
                                    onToggleFavorite={onToggleFavorite}
                                />
                            ))}
                        </div>
                    )}
                    
                    {recentList.length > 0 && (
                        <div className="glass-card p-4">
                            <h3 className="text-sm font-semibold text-gray-400 mb-3 flex items-center gap-2">
                                <i className="fas fa-clock"></i>
                                RECENT
                            </h3>
                            {recentList.map(item => (
                                <HistoryItem 
                                    key={item.ticker}
                                    item={item}
                                    isFavorite={false}
                                    onSelect={onSelect}
                                    onToggleFavorite={onToggleFavorite}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // History Item Component
        function HistoryItem({ item, isFavorite, onSelect, onToggleFavorite }) {
            return (
                <div className="history-item flex items-center justify-between">
                    <div 
                        className="flex-1 cursor-pointer"
                        onClick={() => onSelect(item.ticker)}
                    >
                        <div className="font-semibold">{item.ticker}</div>
                        <div className="text-xs text-gray-500">
                            {new Date(item.timestamp).toLocaleDateString()}
                        </div>
                    </div>
                    <button 
                        onClick={(e) => {
                            e.stopPropagation();
                            onToggleFavorite(item.ticker);
                        }}
                        className="favorite-star"
                    >
                        <i className={`fas fa-star ${isFavorite ? 'text-yellow-400' : 'text-gray-600'}`}></i>
                    </button>
                </div>
            );
        }

        // Settings Panel Component
        function SettingsPanel({ isOpen, onClose, enabledAgents, onToggleAgent }) {
            const agents = [
                { key: 'analyst_consensus', name: 'Analyst Consensus', icon: 'üìä', desc: 'Price targets & ratings' },
                { key: 'news_sentiment', name: 'News Sentiment', icon: 'üì∞', desc: 'Market sentiment analysis' },
                { key: 'management_quality', name: 'Management Quality', icon: 'üëî', desc: 'Leadership assessment' },
                { key: 'peer_comparison', name: 'Peer Comparison', icon: '‚öñÔ∏è', desc: 'Competitor analysis' },
                { key: 'market_intelligence', name: 'Market Intelligence', icon: 'üåç', desc: 'TAM/SAM & market sizing' },
                { key: 'financial_analyst', name: 'Financial Analyst', icon: 'üí∞', desc: 'Financial health analysis' },
                { key: 'tech_risk', name: 'Tech & Risk', icon: 'üî¨', desc: 'Technology assessment' },
                { key: 'valuation', name: 'Valuation', icon: 'üìà', desc: 'Valuation models' }
            ];

            return (
                <>
                    <div 
                        className={`fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity z-[999] ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
                        onClick={onClose}
                    ></div>
                    
                    <div className={`settings-panel ${isOpen ? 'open' : ''}`}>
                        <div className="p-6 border-b border-white/10 flex items-center justify-between">
                            <h2 className="text-xl font-bold">Agent Settings</h2>
                            <button 
                                onClick={onClose}
                                className="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center transition"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div className="p-6 space-y-3">
                            {agents.map(agent => (
                                <div 
                                    key={agent.key}
                                    className="agent-toggle glass-card p-4 cursor-pointer"
                                    onClick={() => onToggleAgent(agent.key)}
                                >
                                    <div className="flex items-center justify-between mb-2">
                                        <div className="flex items-center gap-3">
                                            <span className="text-2xl">{agent.icon}</span>
                                            <div>
                                                <div className="font-semibold">{agent.name}</div>
                                                <div className="text-xs text-gray-400">{agent.desc}</div>
                                            </div>
                                        </div>
                                        <div className={`w-12 h-6 rounded-full transition-all ${enabledAgents[agent.key] ? 'bg-green-500' : 'bg-gray-600'}`}>
                                            <div className={`w-5 h-5 bg-white rounded-full mt-0.5 transition-all ${enabledAgents[agent.key] ? 'ml-6' : 'ml-0.5'}`}></div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </>
            );
        }

        // Analyzing State Component
        function AnalyzingState() {
            return (
                <div className="glass-card p-12 text-center">
                    <div className="w-20 h-20 mx-auto mb-6 rounded-full gradient-bg flex items-center justify-center animate-pulse">
                        <i className="fas fa-brain text-3xl"></i>
                    </div>
                    <h3 className="text-2xl font-bold mb-2">AI Agents Analyzing...</h3>
                    <p className="text-gray-400">Processing market data, financials, and sentiment</p>
                </div>
            );
        }

        // Key Metrics Dashboard Component
        function KeyMetricsDashboard({ metrics }) {
            return (
                <div className="glass-card p-6">
                    <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                        <i className="fas fa-chart-line gradient-bg p-2 rounded-lg"></i>
                        Key Metrics Overview
                    </h2>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <MetricCard 
                            label="Current Price"
                            value={`$${metrics.currentPrice}`}
                            change={metrics.priceChange}
                            icon="fa-dollar-sign"
                        />
                        <MetricCard 
                            label="Market Cap"
                            value={metrics.marketCap}
                            icon="fa-building"
                        />
                        <MetricCard 
                            label="P/E Ratio"
                            value={metrics.peRatio}
                            icon="fa-calculator"
                        />
                        <MetricCard 
                            label="Analyst Rating"
                            value={metrics.analystRating}
                            icon="fa-star"
                            highlight={true}
                        />
                    </div>
                </div>
            );
        }

        // Metric Card Component
        function MetricCard({ label, value, change, icon, highlight }) {
            return (
                <div className={`metric-card ${highlight ? 'border-yellow-400' : ''}`}>
                    <div className="flex items-center justify-between mb-2">
                        <i className={`fas ${icon} text-purple-400`}></i>
                        {change && (
                            <span className={`growth-indicator ${change >= 0 ? 'growth-positive' : 'growth-negative'}`}>
                                <i className={`fas fa-arrow-${change >= 0 ? 'up' : 'down'} text-xs`}></i>
                                {Math.abs(change)}%
                            </span>
                        )}
                    </div>
                    <div className="text-2xl font-bold mb-1">{value}</div>
                    <div className="text-sm text-gray-400">{label}</div>
                </div>
            );
        }

        // Price Target Section Component
        function PriceTargetSection({ targets }) {
            const range = targets.high - targets.low;
            const currentPosition = ((targets.current - targets.low) / range) * 100;
            const avgPosition = ((targets.average - targets.low) / range) * 100;

            return (
                <div className="glass-card p-6 insight-card">
                    <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                        <i className="fas fa-crosshairs gradient-bg p-2 rounded-lg"></i>
                        Analyst Price Targets
                    </h2>
                    
                    <div className="mb-8">
                        <div className="price-target-bar relative mb-12">
                            <div className="price-indicator" style={{left: `${currentPosition}%`}}>
                                Current: ${targets.current}
                            </div>
                            <div className="price-indicator bg-yellow-400" style={{left: `${avgPosition}%`, top: '20px'}}>
                                Target: ${targets.average}
                            </div>
                        </div>
                        
                        <div className="flex justify-between text-sm text-gray-400">
                            <span>Low: ${targets.low}</span>
                            <span>High: ${targets.high}</span>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-3 gap-4">
                        <div className="text-center p-4 rounded-lg bg-red-500/10 border border-red-500/30">
                            <div className="text-2xl font-bold text-red-400">${targets.low}</div>
                            <div className="text-sm text-gray-400">Bear Case</div>
                        </div>
                        <div className="text-center p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
                            <div className="text-2xl font-bold text-yellow-400">${targets.average}</div>
                            <div className="text-sm text-gray-400">Average</div>
                        </div>
                        <div className="text-center p-4 rounded-lg bg-green-500/10 border border-green-500/30">
                            <div className="text-2xl font-bold text-green-400">${targets.high}</div>
                            <div className="text-sm text-gray-400">Bull Case</div>
                        </div>
                    </div>
                    
                    <div className="mt-4 p-4 rounded-lg bg-purple-500/10">
                        <div className="text-sm text-gray-400 mb-1">Upside Potential</div>
                        <div className="text-3xl font-bold text-purple-400">
                            {(((targets.average - targets.current) / targets.current) * 100).toFixed(1)}%
                        </div>
                    </div>
                </div>
            );
        }

        // Financial Metrics Section Component
        function FinancialMetricsSection({ financials }) {
            return (
                <div className="glass-card p-6 insight-card">
                    <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                        <i className="fas fa-chart-bar gradient-bg p-2 rounded-lg"></i>
                        Financial Metrics & Historical Growth
                    </h2>
                    
                    <div className="grid md:grid-cols-2 gap-6">
                        {financials.map((metric, idx) => (
                            <FinancialMetricCard key={idx} metric={metric} />
                        ))}
                    </div>
                </div>
            );
        }

        // Financial Metric Card Component
        function FinancialMetricCard({ metric }) {
            return (
                <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                    <div className="flex items-center justify-between mb-3">
                        <h4 className="font-semibold">{metric.name}</h4>
                        <span className={`growth-indicator ${metric.growth >= 0 ? 'growth-positive' : 'growth-negative'}`}>
                            <i className={`fas fa-arrow-${metric.growth >= 0 ? 'up' : 'down'} text-xs`}></i>
                            {Math.abs(metric.growth)}%
                        </span>
                    </div>
                    <div className="text-2xl font-bold mb-2">{metric.current}</div>
                    <div className="flex justify-between text-sm text-gray-400">
                        <span>1Y Ago: {metric.historical}</span>
                        <span>CAGR: {metric.cagr}%</span>
                    </div>
                </div>
            );
        }

        // Growth Indicators Component
        function GrowthIndicators({ growth }) {
            return (
                <div className="glass-card p-6 insight-card">
                    <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                        <i className="fas fa-rocket gradient-bg p-2 rounded-lg"></i>
                        Growth Projections
                    </h2>
                    
                    <div className="grid md:grid-cols-3 gap-4">
                        <GrowthCard 
                            title="Revenue Growth"
                            current={growth.revenue.current}
                            projected={growth.revenue.projected}
                            timeframe="Next 12M"
                        />
                        <GrowthCard 
                            title="Earnings Growth"
                            current={growth.earnings.current}
                            projected={growth.earnings.projected}
                            timeframe="Next 12M"
                        />
                        <GrowthCard 
                            title="Market Share"
                            current={growth.marketShare.current}
                            projected={growth.marketShare.projected}
                            timeframe="2025E"
                        />
                    </div>
                </div>
            );
        }

        // Growth Card Component
        function GrowthCard({ title, current, projected, timeframe }) {
            const change = ((projected - current) / current) * 100;
            
            return (
                <div className="p-4 rounded-lg bg-gradient-to-br from-purple-500/10 to-blue-500/10 border border-purple-500/30">
                    <h4 className="text-sm text-gray-400 mb-2">{title}</h4>
                    <div className="flex items-end gap-2 mb-2">
                        <span className="text-xl font-semibold text-gray-400">{current}%</span>
                        <i className="fas fa-arrow-right text-gray-500 mb-1"></i>
                        <span className="text-3xl font-bold text-purple-400">{projected}%</span>
                    </div>
                    <div className={`growth-indicator ${change >= 0 ? 'growth-positive' : 'growth-negative'}`}>
                        <i className={`fas fa-arrow-${change >= 0 ? 'up' : 'down'} text-xs`}></i>
                        {Math.abs(change).toFixed(1)}% {timeframe}
                    </div>
                </div>
            );
        }

        // Agent Insights Component
        function AgentInsights({ insights, enabledAgents }) {
            const filteredInsights = insights.filter(agent => 
                enabledAgents[agent.key]
            );

            return (
                <div className="space-y-6">
                    <h2 className="text-2xl font-bold flex items-center gap-2">
                        <i className="fas fa-brain gradient-bg p-2 rounded-lg"></i>
                        AI Agent Analysis
                    </h2>
                    {filteredInsights.map((agent, idx) => (
                        <AgentCard key={agent.key} agent={agent} delay={idx * 0.1} />
                    ))}
                </div>
            );
        }

        // Agent Card Component
        function AgentCard({ agent, delay }) {
            const [expanded, setExpanded] = useState(true);
            
            return (
                <div 
                    className="glass-card overflow-hidden insight-card"
                    style={{ animationDelay: `${delay}s` }}
                >
                    <div 
                        className="gradient-bg p-6 cursor-pointer"
                        onClick={() => setExpanded(!expanded)}
                    >
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="text-4xl">{agent.icon}</div>
                                <div>
                                    <h3 className="text-xl font-bold">{agent.name}</h3>
                                    <p className="text-purple-100">{agent.subtitle}</p>
                                </div>
                            </div>
                            <i className={`fas fa-chevron-${expanded ? 'up' : 'down'} text-2xl`}></i>
                        </div>
                    </div>
                    
                    {expanded && (
                        <div className="p-6">
                            <div className="prose prose-invert max-w-none">
                                <p className="text-lg text-gray-300 mb-4">{agent.summary}</p>
                                
                                <div className="grid md:grid-cols-2 gap-4 mt-6">
                                    <div className="p-4 rounded-lg bg-green-500/10 border border-green-500/30">
                                        <h4 className="font-semibold text-green-400 mb-3 flex items-center gap-2">
                                            <i className="fas fa-check-circle"></i>
                                            Key Strengths
                                        </h4>
                                        <ul className="space-y-2 text-sm">
                                            {agent.strengths.map((s, i) => (
                                                <li key={i} className="flex gap-2">
                                                    <span className="text-green-400">‚Ä¢</span>
                                                    <span>{s}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                    
                                    <div className="p-4 rounded-lg bg-red-500/10 border border-red-500/30">
                                        <h4 className="font-semibold text-red-400 mb-3 flex items-center gap-2">
                                            <i className="fas fa-exclamation-triangle"></i>
                                            Key Risks
                                        </h4>
                                        <ul className="space-y-2 text-sm">
                                            {agent.risks.map((r, i) => (
                                                <li key={i} className="flex gap-2">
                                                    <span className="text-red-400">‚Ä¢</span>
                                                    <span>{r}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Charts Section Component
        function ChartsSection({ analysis }) {
            return (
                <div className="glass-card p-6 insight-card">
                    <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                        <i className="fas fa-chart-pie gradient-bg p-2 rounded-lg"></i>
                        Visual Analytics
                    </h2>
                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="bg-white/5 rounded-lg p-4">
                            <h3 className="font-semibold mb-4 text-center">Valuation Scenarios</h3>
                            <canvas id="scenarioChart" height="200"></canvas>
                        </div>
                        <div className="bg-white/5 rounded-lg p-4">
                            <h3 className="font-semibold mb-4 text-center">Quality Score</h3>
                            <canvas id="qualityChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            );
        }

        // Mock Data Generator
        function generateEnhancedAnalysis(ticker, enabledAgents) {
            const currentPrice = Math.random() * 500 + 50;
            const avgTarget = currentPrice * (1 + (Math.random() * 0.4 - 0.1));
            
            return {
                ticker,
                metrics: {
                    currentPrice: currentPrice.toFixed(2),
                    priceChange: (Math.random() * 10 - 5).toFixed(2),
                    marketCap: `$${(Math.random() * 100 + 10).toFixed(1)}B`,
                    peRatio: (Math.random() * 50 + 10).toFixed(1),
                    analystRating: ['Strong Buy', 'Buy', 'Hold'][Math.floor(Math.random() * 3)]
                },
                priceTargets: {
                    current: currentPrice.toFixed(2),
                    average: avgTarget.toFixed(2),
                    low: (avgTarget * 0.7).toFixed(2),
                    high: (avgTarget * 1.3).toFixed(2)
                },
                financials: [
                    {
                        name: 'Revenue',
                        current: `$${(Math.random() * 50 + 10).toFixed(1)}B`,
                        historical: `$${(Math.random() * 40 + 8).toFixed(1)}B`,
                        growth: (Math.random() * 30 + 5).toFixed(1),
                        cagr: (Math.random() * 25 + 10).toFixed(1)
                    },
                    {
                        name: 'Gross Margin',
                        current: `${(Math.random() * 30 + 40).toFixed(1)}%`,
                        historical: `${(Math.random() * 30 + 35).toFixed(1)}%`,
                        growth: (Math.random() * 10 - 5).toFixed(1),
                        cagr: (Math.random() * 8 + 2).toFixed(1)
                    },
                    {
                        name: 'Free Cash Flow',
                        current: `$${(Math.random() * 10 + 2).toFixed(1)}B`,
                        historical: `$${(Math.random() * 8 + 1).toFixed(1)}B`,
                        growth: (Math.random() * 40 + 10).toFixed(1),
                        cagr: (Math.random() * 30 + 15).toFixed(1)
                    },
                    {
                        name: 'R&D Spending',
                        current: `$${(Math.random() * 5 + 1).toFixed(1)}B`,
                        historical: `$${(Math.random() * 4 + 0.8).toFixed(1)}B`,
                        growth: (Math.random() * 25 + 5).toFixed(1),
                        cagr: (Math.random() * 20 + 10).toFixed(1)
                    }
                ],
                growthMetrics: {
                    revenue: { current: 15, projected: 22 },
                    earnings: { current: 12, projected: 28 },
                    marketShare: { current: 18, projected: 25 }
                },
                agentInsights: [
                    {
                        key: 'analyst_consensus',
                        name: 'Analyst Consensus',
                        icon: 'üìä',
                        subtitle: 'Wall Street Price Targets & Ratings',
                        summary: `Based on ${Math.floor(Math.random() * 20 + 10)} analyst ratings, ${ticker} has a consensus rating of "${['Strong Buy', 'Buy', 'Hold'][Math.floor(Math.random() * 3)]}" with an average price target of $${avgTarget.toFixed(2)}, representing ${(((avgTarget - currentPrice) / currentPrice) * 100).toFixed(1)}% upside from current levels.`,
                        strengths: [
                            'Strong analyst consensus with majority buy ratings',
                            'Recent upgrades from major institutions',
                            'Price targets consistently revised upward',
                            'Positive earnings estimate revisions'
                        ],
                        risks: [
                            'Wide range of price targets indicating uncertainty',
                            'Some analysts flagging valuation concerns',
                            'Execution risk on guidance delivery'
                        ]
                    },
                    {
                        key: 'news_sentiment',
                        name: 'News Sentiment',
                        icon: 'üì∞',
                        subtitle: 'Market Sentiment & Social Analysis',
                        summary: `Recent news sentiment for ${ticker} is predominantly positive, with ${Math.floor(Math.random() * 30 + 60)}% bullish coverage over the past 30 days. Social media sentiment shows increasing retail interest with strong momentum indicators.`,
                        strengths: [
                            'Positive media coverage on recent product launches',
                            'Strong social media engagement and retail interest',
                            'Favorable industry analyst commentary',
                            'Increasing institutional ownership signals'
                        ],
                        risks: [
                            'Some negative sentiment around competitive pressures',
                            'Regulatory scrutiny mentioned in recent articles',
                            'Market volatility affecting sector sentiment'
                        ]
                    },
                    {
                        key: 'management_quality',
                        name: 'Management Quality',
                        icon: 'üëî',
                        subtitle: 'Leadership & Governance Assessment',
                        summary: `${ticker}'s management team demonstrates strong execution capabilities with a proven track record. CEO has ${Math.floor(Math.random() * 15 + 5)} years industry experience and the leadership team has consistently met or exceeded guidance.`,
                        strengths: [
                            'Experienced leadership with deep industry knowledge',
                            'Strong track record of delivering on commitments',
                            'Insider buying signals confidence',
                            'Clear strategic vision and capital allocation'
                        ],
                        risks: [
                            'Key person dependency on CEO',
                            'Executive compensation above peer average',
                            'Recent management turnover in key positions'
                        ]
                    },
                    {
                        key: 'peer_comparison',
                        name: 'Peer Comparison',
                        icon: '‚öñÔ∏è',
                        subtitle: 'Competitive Positioning Analysis',
                        summary: `Compared to industry peers, ${ticker} ranks in the ${['top quartile', 'upper half', 'middle'][Math.floor(Math.random() * 3)]} for growth metrics and profitability. The company maintains ${['leading', 'strong', 'competitive'][Math.floor(Math.random() * 3)]} market position with differentiated offerings.`,
                        strengths: [
                            'Superior gross margins vs peer average',
                            'Faster revenue growth than competitors',
                            'Market share gains in key segments',
                            'Better return on invested capital'
                        ],
                        risks: [
                            'Trading at premium valuation to peers',
                            'Competitive intensity increasing',
                            'Smaller scale than industry leaders'
                        ]
                    },
                    {
                        key: 'market_intelligence',
                        name: 'Market Intelligence',
                        icon: 'üåç',
                        subtitle: 'TAM/SAM & Market Opportunity',
                        summary: `${ticker} operates in a ${['$${Math.floor(Math.random() * 500 + 100)}B', '$${Math.floor(Math.random() * 200 + 50)}B'][Math.floor(Math.random() * 2)]} total addressable market (TAM) with current market share of approximately ${Math.floor(Math.random() * 20 + 5)}%. The serviceable addressable market (SAM) is growing at ${Math.floor(Math.random() * 15 + 10)}% CAGR.`,
                        strengths: [
                            'Large and growing TAM with significant runway',
                            'Expanding SAM through new product categories',
                            'First-mover advantages in emerging segments',
                            'Market trends strongly favoring core offerings'
                        ],
                        risks: [
                            'TAM growth dependent on macro conditions',
                            'Market saturation in mature segments',
                            'New entrants targeting high-growth niches'
                        ]
                    },
                    {
                        key: 'financial_analyst',
                        name: 'Financial Health',
                        icon: 'üí∞',
                        subtitle: 'Balance Sheet & Cash Flow Analysis',
                        summary: `${ticker} maintains a ${['fortress', 'strong', 'healthy'][Math.floor(Math.random() * 3)]} balance sheet with net cash position of $${(Math.random() * 20 + 5).toFixed(1)}B. Free cash flow generation has been robust with ${Math.floor(Math.random() * 30 + 20)}% FCF margins.`,
                        strengths: [
                            'Strong cash position with no debt concerns',
                            'Improving operating leverage driving margin expansion',
                            'Consistent free cash flow generation',
                            'High returns on invested capital'
                        ],
                        risks: [
                            'Working capital intensity in growth phase',
                            'Increasing capex requirements',
                            'Currency exposure affecting margins'
                        ]
                    },
                    {
                        key: 'tech_risk',
                        name: 'Technology & Innovation',
                        icon: 'üî¨',
                        subtitle: 'Product & Tech Assessment',
                        summary: `${ticker}'s technology stack is ${['cutting-edge', 'competitive', 'evolving'][Math.floor(Math.random() * 3)]} with significant R&D investment at ${Math.floor(Math.random() * 10 + 5)}% of revenue. The company holds ${Math.floor(Math.random() * 5000 + 1000)} patents.`,
                        strengths: [
                            'Strong IP portfolio and patent moat',
                            'Continuous innovation pipeline',
                            'Technology leadership in key areas',
                            'Successful product launch track record'
                        ],
                        risks: [
                            'Rapid technology changes requiring constant innovation',
                            'R&D execution risk on next-gen products',
                            'Platform dependencies and ecosystem risks'
                        ]
                    },
                    {
                        key: 'valuation',
                        name: 'Valuation Analysis',
                        icon: 'üìà',
                        subtitle: 'DCF & Multiples Analysis',
                        summary: `On a DCF basis, ${ticker} trades at ${['a discount', 'fair value', 'a premium'][Math.floor(Math.random() * 3)]} to intrinsic value. Forward P/E of ${(Math.random() * 30 + 15).toFixed(1)}x is ${['below', 'in-line with', 'above'][Math.floor(Math.random() * 3)]} historical average and peer median.`,
                        strengths: [
                            'Attractive risk/reward at current levels',
                            'Multiple expansion potential with earnings delivery',
                            'Trading below historical valuation ranges',
                            'Sum-of-parts analysis shows upside'
                        ],
                        risks: [
                            'Valuation vulnerable to multiple compression',
                            'High expectations embedded in current price',
                            'Sensitivity to discount rate assumptions'
                        ]
                    }
                ]
            };
        }

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StockAnalysisApp />);
        
        // Initialize charts after a delay
        setTimeout(() => {
            const scenarioCtx = document.getElementById('scenarioChart');
            const qualityCtx = document.getElementById('qualityChart');
            
            if (scenarioCtx) {
                new Chart(scenarioCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Bear', 'Base', 'Bull'],
                        datasets: [{
                            data: [-20, 35, 150],
                            backgroundColor: ['rgba(239, 68, 68, 0.8)', 'rgba(245, 158, 11, 0.8)', 'rgba(16, 185, 129, 0.8)']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { ticks: { callback: v => v + '%', color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { ticks: { color: '#9ca3af' }, grid: { display: false } } }
                    }
                });
            }
            
            if (qualityCtx) {
                new Chart(qualityCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Financial', 'Market', 'Tech', 'Management', 'Valuation', 'Sentiment'],
                        datasets: [{
                            data: [8, 7, 8, 9, 6, 7],
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            borderColor: 'rgb(102, 126, 234)',
                            pointBackgroundColor: 'rgb(102, 126, 234)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { r: { beginAtZero: true, max: 10, ticks: { color: '#9ca3af', backdropColor: 'transparent' }, grid: { color: 'rgba(255,255,255,0.1)' }, pointLabels: { color: '#9ca3af' } } }
                    }
                });
            }
        }, 100);
    </script>
</body>
</html>
